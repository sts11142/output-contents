---
title: "【Colab × FastAPI × ngrok】Google Colabを用いたローカルLLM向け簡易GPU・Webサーバ構築入門"
emoji: "🤗"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["FastAPI", "Llama", "googlecolaboratory", "ngrok", "LLM"]
published: false
---


# 本記事の目的と対象読者

本記事では、Google Colab上でGPUリソースを活用し、FastAPIとngrokを用いてローカルLLMデモアプリを外部からアクセス可能なWebサーバとして構築する方法を解説します。

対象とする読者は、

- ローカルLLMのデモアプリを作成したいが、オンプレやクラウドサーバ環境整備に悩んでいる初心者〜中級者
- 簡易なプロトタイプを短時間で立ち上げたいエンジニア

です。

# 本記事のモチベーション

## 想定シナリオ

研究室内で使う**簡易なローカルLLMデモアプリを一時的にアクセス可能な形で共有したい**場合や、GPU付きマシンが手元にないけど短期間でLLMを動かして確認したいケースを想定しています。

しばしばこういう「サクッとLLMを試したい」ケースでは [Gradio](https://www.gradio.app/) も非常に有効な選択肢として上がりますが、UI構築上の制約があるため、多少の自由度を求めて本記事では使用しません。
（Gradioでも同様のことが出来ると思います）

## 本記事で扱う範囲と前提条件

- LLM・Webサーバの実行環境としてGoogle Colabを利用（有料(Pro)プランを想定）
- セキュリティや耐障害性、パフォーマンス最適化（e.g. モデルの量子化）は一旦考慮しません
  - つまり最小限の実装（...工夫の余地があるってこと？！）
- FastAPIでHTTPエンドポイントを用意し、ngrokで外部公開する流れを説明します
- Gradioは使わずに、LLM実行環境とUI実装を切り離して扱います

# なぜGoogle Colabを選ぶのか

今回のシナリオで求める要件は以下の通りです。

- （必須）WebサーバとしてHTTPリクエストを受け付ける機能
  - e.g. ユーザーからの入力受付、およびLLM推論結果の返却
- （必須）LLM推論で使用するGPUリソースへのアクセス
- （希望）LLMをPythonで扱う都合上、WebサーバもPythonベースで構築可能な環境が望ましい

以上を踏まえ、先に結論を述べると、デモ的なLLMアプリケーションを手軽に実行する手段としては**Google Colab**が有力な手段と言えそうです。

ColabのPros&Cons：

- Pros
  - 比較的低コストでGPUリソースを使用可能
  - Python実行環境が標準で整備されているので、Webサーバの構築が容易
  - 短時間でWebサーバ（FastAPIなど）を起動し、ngrok経由で外部公開可能
- Cons
  - Notebook形式（という制限はあるものの、優秀なPythonライブラリ・FWでカバー可能）
  - 長時間稼働や高度なカスタマイズには不向き

いくつか不便な点もありますが、**デモ用途であれば大きな問題とはなりにくい**という結論です。

以下の比較は、GPUリソース利用とWebサーバ構築が可能なサービスを、約40時間の短期的デモ利用という前提で比較した一例です。
（料金はドル為替やプランにより変動します）

:::details 他サービスの比較・検討

|サービス|デモ用途での適性|コスト目安|
|----|----|----|
| Google Colab | GPU対応ノートブック環境<br />外部公開はngrokなどで可能<br />一時的デモには十分 | 約1,200円/100 Unit<br />L4 GPU: 約2.4 Unit/hr<br />（→約30円/hr）<br />40 hr利用で約1,200円程度 |
| AWS (EC2) | IaaS型で柔軟性が高く本格運用向け<br />初期設定、権限管理、コスト管理が比較的複雑 | P3インスタンス例: 約480円/hr<br />40 hrで約19,200円 |
| GCP | 同上（IaaS型で柔軟性が高い）<br />設定はAWS同様に手間がかかる | T4(32GB)例: 約170円/hr<br />40 hrで約6,800円 |
| Paperspace | Colab類似のDaaS型環境<br />手軽だが環境カスタマイズ幅は限定的 | V100(32GB)例: 約360円/hr<br />40 hrで約14,400円 |

AWSやGCPは機能が豊富で柔軟性が高い反面、GPUインスタンスのコストや初期設定の手間が大きくなります。慣れていない人がデモで敢えて選択するメリットは薄いと感じます。
PaperspaceはColab同様にノートブック形式で比較的簡易なようなのですが、料金面・柔軟性の点でColabより有利とは言い難いかもしれません（使ったことがないため、実際の使用面は見聞きした程度です）。

:::

総合すると、**短期的なデモ用途**であれば、

- GPUが手軽に使えて、
- PythonベースのWebサーバを素早く起動・公開できる

という点で，Google Colabは他のサービスに比べて導入障壁やコスト面で有利だと判断しました。


# ツール選定理由

# 全体構成のイメージ

# 手順概要

# 実装例

# 応用と発展

# まとめ

本記事で示した方法を用いれば、手軽にGoogle Colab上でFastAPIサーバを起動し、ngrokで外部からアクセスできる環境を構築することが可能です。

ローカルLLMを用いたデモアプリを作成する際には、ぜひご参考にしてください！
